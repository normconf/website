
<!DOCTYPE html>
<html>

<head>
  <title>Normconf: Ethan Rosenthal and the M1 misadventure -  Ethan Rosenthal Transcript</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="Transcript of Ethan Rosenthal and the M1 misadventure -  Ethan Rosenthal from Normconf" />
  <meta property="og:title" content="Normconf: Ethan Rosenthal and the M1 misadventure -  Ethan Rosenthal Transcript" />
  <meta property="og:url" content="https://normconf.com" />
  <meta name="og:description"
    content="Transcript of Ethan Rosenthal and the M1 misadventure -  Ethan Rosenthal from Normconf" />
  <meta property="og:image" content="https://normconf.com/images/normconf_banner_metadata_1000x500.png" />
  <meta property="og:type" content="website" />
  <meta name="twitter:image" content="https://normconf.com/images/normconf_banner_metadata_1000x500.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="normconf.com" />
  <meta name="twitter:creator" content="@normconf" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link href="fontawesome/css/all.min.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <style>
    body {
      background-image: url('images/background_placeholder.png');
    }

    .hero {
      background-color: None;
      color: #797979;
      font-family: sans-serif;
    }

    .center {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 50%;
    }

    a:link {
      color: #4200be;
    }

    a:visited {
      color: #4200be;
    }

    a:active {
      color: #ef028c;
    }

    a:hover {
      color: #ef028c;
    }

    a.light_link:link {
      color: #ef028c;
    }

    a.light_link:visited {
      color: #4200be;
    }

    a.dark_link:link {
      color: #ef028c;
    }

    a.dark_link:visited {
      color: #ef028c;
    }

    a.dark_link:active {
      color: #5fffcf;
    }

    a.dark_link:hover {
      color: #5fffcf;
    }

    a.on_pink:link {
      color: #5fffcf;
    }

    a.on_pink:active {
      color: #6017af;
    }

    a.on_pink:hover {
      color: #4200be;
    }

    .navbar.is-dark .navbar-end>a.navbar-item:hover {
      background-color: #ef028c;
    }

    .navbar.is-dark .navbar-item {
      white-space: normal;
    }

    .navbar.is-dark .navbar-item.has-dropdown:hover .navbar-link {
      background-color: #ef028c;
    }

    .navbar.is-dark .navbar-brand>a.navbar-item:hover {
      background-color: #6017af;
    }

    .button.is-danger {
      background-color: #ef028c;
    }

    .button.is-primary {
      background-color: #5fffcf;
      color: #4200be;
    }

    table.speakers1 {
      font-weight: bold;
      color: #4200be;
      width: auto;
    }

    table.speakers2 {
      font-weight: bold;
      color: #6017af;
      width: auto;
    }

    table.schedule {
      font-weight: bold;
      /* width: auto; */
    }

    table.schedule td {
      text-align: center;
      padding: 0.5em;
      max-width: 30em;
      /* word-wrap: break-word; */
    }

    table.schedule tr:nth-child(odd) {
      color: #4200be;
      background-color: #00000017;
    }

    table.schedule tr:nth-child(even) {
      color: #6017af;
    }

    .message.is-primary .message-header {
      background-color: #5fffcf;
      color: #4200be;
    }
  </style>
  </head>
  <body>
  <section class="section" style="background-color: #6017af;">
    <div class="container">
    <div class="box">
      <h1 class="title">
        Ethan Rosenthal and the M1 misadventure -  Ethan Rosenthal
      </h1>
      <p class="subtitle">
        Transcript generated with <a href='https://github.com/openai/whisper'>OpenAI Whisper</a> <code>large-v2</code>.
      </p>
      </div>
      <div class="box">
        <a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=0">Hi, everybody. My name is Ethan Rosenthal. I manage a small team of AI engineers at Square. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=8">I'm not going to talk about any of that fun stuff today. We do things with large language </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=14">models and all sorts of hot stuff. Like with much of this job, I think the majority of </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=20">my job is not doing that stuff and it's instead dealing with the norm-confy things. Today, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=26">I'm going to talk about the absolute terrible time that I had trying to get my team's code </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=31">base to build on an Apple M1 laptop. And so this is largely going to be a cathartic rant, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=39">but I hope that it's also, you know, helpful and maybe you all will learn something too </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=44">along the way. So why am I talking about this today? I would be surprised if you could forget, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=51">but if you all remember our, you know, intrepid norm-conf leader, Vicky, sent out that tweet </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=56">that was heard around the world back in July about creating this conference. And I was </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=61">like nose deep into trying to get my team's code base to build on this M1. And I, you </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=67">know, kind of snarkily made a reply to that tweet. And here I am now actually talking </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=73">about that. So kind of fun to bring things full circle. So what is the M1? For those </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=78">of you who don't know, back in 2020, Apple released a new line of laptops that use their </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=84">M1 chip, which is kind of like the first time that Apple had created their own CPUs, like </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=89">specifically for their laptops. And so they followed up like a year later with the M1 </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=94">Pro and the M1 Max, and it had all these nice charts showing that, you know, you get more </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=98">performance for lower power. And so, you know, a lot of people are excited about that, you </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=102">know, who doesn't want their code to run faster and who doesn't want to burn their thighs </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=106">with their laptop when it's using too much power. And so this all seemed cool, but I </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=112">was not very interested in any of this because, you know, I know the first rule of programming, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=117">which is that you should never change anything. Like if it ain't broke, don't fix it. And </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=122">my team's code base was working. And so I don't want to mess with like success. Unfortunately, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=130">you know, time is like the one thing that changes that, you know, none of us can stop </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=134">that even if we wanted to. And so what happened at work was that in January 2022, there was, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=141">it was announced that M1s were now available to new hires at the company, as well as people </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=145">that were eligible to upgrade their laptop if, you know, their current laptop was kind </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=149">of old. And so they made that announcement. And one of the people on my team was kind </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=154">of excited by these new laptops. And so they requested an upgrade, they got an M1 and they </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=160">failed to get the code base to build. You know, they spent about a week with this and </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=165">no luck. And then a couple months later, another teammate tries to get a new M1, spends a week </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=173">trying to build the code base and they fail. And then in August, we knew that there would </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=178">be two new members starting on the team and they were going to be issued M1s. And I stupidly </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=185">decided to start managing the team a couple of weeks before. And so this meant that this </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=189">was now my problem and I was going to be the one that had to figure this out. And so like </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=196">any good engineer, I completely underestimated how much work or time this could possibly </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=200">take. But, you know, I tried to be reasonably smart about this. And so anytime you embark </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=209">on something new at a company, I think it's a good idea to, you know, check the wisdom </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=213">of the masses. And, you know, Square is the biggest company I've worked at. I used to </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=217">work at some startups before this and I never really appreciated how helpful it is to have </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=222">a big company Slack. It's kind of like your own personal Reddit where you can get recommendations </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=226">for like local accountants or holiday gift ideas and everything else. And so I decided </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=232">to delve into Slack to try to see if anybody else had already run into this problem before. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=237">And so, you know, I'm reading through Slack search and other sorts of things. And I find </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=241">these esoteric Google Docs and Notion Docs where other people had attempted to solve </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=248">this problem. And if you search through these docs, you stumble upon these like incantations, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=252">right? These cryptic brew libraries that you have to install before you do anything and </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=258">these other cryptic environment variables that you have to set. And, you know, you don't </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=261">understand what any of this means, but you're just going to like copy and paste it and run </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=265">it like everything else that you do with Stack Overflow. So I did that and I thought, all </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=270">right, like I'm good to go. Other people have run into this. I'll be good to go. And so </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=273">the first step is, you know, now that I've done my Roo installing and set my environment </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=277">variables, now I just need to install Python. Like my team's code base is built in Python. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=282">That's the first step. And immediately I failed because my team's code base was based on Python </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=288">3.7, which it turns out is not supported on Apple M1 laptops. And so now I find out that </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=297">we can't use our version of Python. We're going to have to change the version of Python. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=300">Thankfully, it's not like going from two to three, but you know, I'm guessing most of </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=303">you out there probably don't like to change your version of Python too often. And so setting </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=309">this version, this Python version, this was kind of like the first node in this like tangled </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=315">web of shit that I had to wade through. And so one recommendation I have is if you want </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=323">to deal with different versions of Python, Pyenv is a great little package that allows </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=328">you to install different versions of Python on your laptop. And so then anytime you are, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=333">you know, starting a new project, starting a new virtual environment, you can choose </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=337">which version of Python you're going to use via that. And then, you know, I had to decide </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=343">which version of Python to use. And I think, you know, my rule of thumb is to like to go </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=347">with Goldilocks. So don't go with the latest and greatest 3.10 because, you know, this </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=353">is like on the bleeding edge. Don't go with the oldest 3.8 because it's, you know, it </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=357">was kind of like almost out of support by that point. And so just, you know, go with </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=361">something in the middle that's only a couple of years old. So we chose 3.9. So this was </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=366">like a two minor version upgrade that we went from 3.7 to 3.9. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=372">So now that I've changed my version of Python, this means that I'm going to have to change </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=376">some of my Python dependencies because certain dependencies only work with like certain versions </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=381">of your dependencies only work with certain versions of Python. So what I mean by a Python </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=386">dependency is like a library that you are pip installing like NumPy or Matplotlib or </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=390">something like that. And so now I'm going to have to change the versions of these dependencies, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=397">but it's not just that I have to change them because they are now incompatible with my </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=401">new version of Python. The other issue is that I have this brand new flashy sports car </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=407">of a laptop and there are no wheels. So Python wheels, for those of you who don't know, are </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=416">like zip files where other people have kind of like prebuilt your code so that it will </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=420">run wherever you run your code. And so for a lot of these libraries, you need prebuilt </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=425">wheels in order to run this code on like your laptop or in the cloud or something like that. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=431">And it turned out that even if I had certain Python dependencies whose versions worked </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=436">with my new version of Python, these versions of these dependencies did not work on Apple </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=442">M1s. And so now I need to go and find what version actually introduced wheels that are </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=447">compatible with the M1. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=450">OK, so we've changed our version of Python. We've changed a whole bunch of Python dependencies. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=456">And then ideally, you are not managing these dependencies yourself. I think if you're spending </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=461">all day kind of hard coding all of your dependencies into a requirements.txt file, then you're </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=465">not going to have a good time. But if you use a dependency manager, which is a tool </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=470">where you can kind of declare, you know, these are the high level dependencies that I need </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=474">for my package, then this manager will go out and find those dependencies, dependencies, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=480">those dependencies, dependencies, dependencies, and this entire like nested graph. And it </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=484">will make sure that it finds, you know, the exact versions of all of the sub-dependencies </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=489">such that everything will work and kind of, you know, be reproducible every time you install </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=494">your package. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=496">And be aware, a little bit of self-promotion, but I have an entire blog post about this </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=499">where my actual entire process around how I do data science is that every time I start </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=505">a new project or analysis, I create an entire Python package and I manage all the dependencies </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=510">with a dependency manager. And the nice thing here is that this means that, you know, six </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=514">months later when I come back to the analysis, because, you know, some stakeholder had a </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=519">question in a Google doc from an analysis that I ran six months ago, I can, you know, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=523">reinstall my package and rerun my analysis and have everything work. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=531">The other thing that I learned in this process is, you know, it's kind of difficult sometimes </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=536">to make sure that all of your different versions of your Python package actually all work together. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=541">And so what you end up finding is that, you know, you run your dependency manager, try </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=545">to get all your versions to work together, and the dependency manager spits out some, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=548">you know, weird error saying, you know, these two packages conflict with each other. There </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=553">is no way that you can install all of these. So I kept running into this and a very stupid </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=558">skill that I now have is that I learned how to debug this pretty well. And my debugging </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=563">strategy is that I create a minimum viable Python package. And so what that means is </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=568">that instead of starting with my huge code base that has all these dependencies that </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=573">takes, you know, it takes a really long time to add a new dependency because you have to, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=577">like, traverse this giant graph, I create a tiny little new Python package and I first </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=583">install that offending dependency that seems to conflict with other ones. And then one </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=588">by one, I start to add some new dependencies until the conflict appears. And then I know </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=593">which exact dependencies are conflicting with each other. Hopefully, like, you know, chat </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=598">GPT solves one day and you can just ask it, you know, feed it your lock file and ask it </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=602">what the issue is. But until then, you now have this very painful process that you get </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=610">to go through, too. Along the way, you know, we were using pipenv </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=615">as our dependency manager. I never really liked it. I always wanted to change the poetry, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=620">but I, you know, don't like to change things at the same time because everything was working. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=625">But, you know, never let a good crisis go to waste. And so we ended up switching our </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=628">dependency manager in the process. We also had to do this because for the life of me, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=632">I could not get SciPy to install with pipenv. I think there was a bug somewhere. And so </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=637">this ended up being actually like a necessary requirement of this refactor. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=642">So now we've changed our version of Python. We've changed a whole bunch of dependencies. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=645">And we've changed the way that we actually install and manage those dependencies. And </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=650">so, of course, we don't do all of this manually because we are engineers and we like to abstract </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=655">stuff and, you know, build declarative systems. And so everybody's favorite declarative system, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=661">the make file, and we have, you know, a couple hundred line make file in our code base. This </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=667">now needed to be updated to work with the new dependency manager. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=672">But thankfully by this point, I actually got everything to build. So, you know, I was able </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=676">to build my code. I was able to run tests. I was able to, you know, train some small </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=680">models on my laptop. So I should be done, right? I fixed it for the new laptop. But </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=686">unfortunately code doesn't just run on our laptops. Code runs in the cloud. And the way </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=692">that we run our code in the cloud is we build Docker images, at least on my team. So we </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=697">use a Docker file to build a Docker image. And then we ship our code up to the cloud </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=701">and run the code up there. And that Docker file is building the code that we are writing </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=707">locally. And so there is kind of a natural coupling between the Docker file and our code </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=711">base. And one of the things that the Docker file has to do is it has to install Python. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=715">It has to install Python dependencies and other sorts of things like that. And so this </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=719">meant that I needed to update all of our Docker files so that they now worked with this new </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=724">setup. But we don't just run regular code in the cloud. We run code on GPUs because </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=730">we're training fun things like language models and everything else. And that code that runs </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=734">on GPUs, you know, we need to install CUDA, which is like the NVIDIA library. We need </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=740">to install that in both the Docker container as well as the EC2 instances that the container </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=746">is running on. And so now we have this other piece of our cobweb. If you go to NVIDIA's </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=753">website, they have this diagram there where I think they're trying to argue that it's </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=757">simple to do stuff on GPUs. And maybe it's a lot simpler than it used to be. But what </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=763">you actually are not really, you know, what's not entirely clear until you look closer at </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=767">this is that there's this tight coupling that exists in GPUs between all sorts of layers </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=773">of the stack. So you have to make sure that you have like the right versions of drivers </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=778">and CUDA that are running on the actual instance that's running in the cloud. That is coupled </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=782">to the version of these libraries that is running in the Docker container. And all of </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=787">this gets coupled with the application that is actually doing the programming, which in </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=791">our cases is PyTorch code. And it turns out that all of this coupling is terrible. And </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=797">it's like a lot of work and it's a total pain. And I wanted to try to find the words, but </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=802">I couldn't find the words to convey this to you. And so instead I decided to burden some </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=806">GPU hours and ask Stable Diffusion to paint me a Renaissance painting of a GPU burning </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=811">in hell. And ironically, the hallmark of the GPU here is really the heatsink fans, which </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=817">seem to be trying to dissipate the heat of hell. And so, yeah. So if you go to PyTorch's </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=826">website, which is the deep learning library that we use, they have this wonderful little </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=832">widget where you can pick, you know, are you on Linux or Mac? Do you install your Python </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=837">packages with pip? Which version of CUDA are you on? You pick all of these pieces and then </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=843">they give you this wonderful command that if you just run it, works most of the time </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=846">in order to install these libraries. And all of this is great if you're on like the latest </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=851">and greatest version of PyTorch. But for various reasons, my team was not. And so if you try </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=857">to go back to earlier versions of PyTorch, this is the recommendation. So depending on </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=862">which version of CUDA you're running or if you need GPU support or not, and which platform </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=868">you're on, you have all of these different pip commands with like pip indices and other </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=873">sorts of things that you have to worry about. And so, you know, I needed this to work with </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=878">our dependency manager. And so I was having some trouble. So I decided to search on Google </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=883">for how to, you know, work with PyTorch and poetry and stumbled upon, you know, 36 common </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=889">GitHub issues that was prematurely closed because the problem was definitely not resolved. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=894">And so then a new issue was opened. And that issue is definitely still open because this </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=899">is entirely unresolved right now. And so I ended up doing something terrible. You know, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=905">I had this beautiful dependency manager that allowed me to, you know, declare my dependencies </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=910">and it would figure everything out for me. And instead I ended up kind of just having </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=915">to hack and ruin it. So what I ended up deciding to do was that, you know, in our code base </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=921">in the dependency manager, we would just install the version of PyTorch that does not have </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=924">any GPU support because I don't have any GPUs locally. And then in our Docker file, we're </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=931">going to first export a requirements.txt file from our dependency manager. So we will generate </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=938">kind of like running pit freeze. We're going to generate all of our requirements. And then </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=942">I have this terrible sed command, which just substitutes the line of PyTorch with a hardcoded </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=948">URL to a wheel of my exact version of PyTorch. And so it feels bad, but it works. And I haven't </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=954">touched it since I made this change. And so maybe that's a sign that it's working. And </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=958">if you're struggling with PyTorch and poetry, this hack, like it actually does work. So </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=964">sorry if you end up having to implement it too. So fine, we've figured out how to build </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=969">our code locally. We've figured out how to make sure that that code also works in the </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=972">cloud. We're good to go, right? Unfortunately, there's actually a third place that my team </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=979">runs code and that's in continuous integration. So anytime we want to merge our code into </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=983">our main branch of our repo, we run various tests and things like that in our own build </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=988">system, kind of like GitHub actions. And so we need to do everything within continuous </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=993">integration as well. And it was at this point that I realized that kind of like, I've been </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1002">possibly blaming a lot of other systems out there, right? I've been complaining a bit </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1007">about GPUs and poetry and all sorts of other things. But part of this is my team's fault </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1013">as well. And so one of our issues that I realized is that we had three entirely separate different </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1017">processes for where our code runs. So when we're local on our laptop, we have one way </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1023">of installing Python. You have to install a dependency manager, install those dependencies </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1027">and then run your tests or run your code. And so there is a very set process for doing </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1031">that on your laptop. But then when you're in CEI, there's an entirely separate process </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1036">for installing Python, an entire separate process for installing those dependencies. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1041">And there's a little bit of coupling between the two. We kind of use a make file for a </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1044">little bit of this coupling, but not fully. And then within Docker, there's an entirely </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1049">separate process for all of these. And so what this meant was that any time I had to </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1054">change one of these blocks, I had to change it in three different places. And so this </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1058">is maybe a sign that we have not architected our setup in quite the right way. And so I </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1064">realized actually after this that at previous companies that I'd worked at, we had been </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1068">a bit smarter about this. And so one option is that you do all of your CEI within the </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1073">same Docker container that you're going to use when you run your code in the cloud. And </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1078">this actually kind of makes sense because the whole point of CEI is to test your code </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1083">in an environment that's fairly similar to the production environment, kind of like the </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1087">same way that you create a test set with your machine learning model, because you want that </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1091">test to be representative of what's going to actually happen when your model is running </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1095">in the real world. And so one option is to use that exact same Docker container within </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1101">CEI so that you only have like, you know, within that container, you have your method </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1105">of installing Python and the dependencies and everything else. And then this way, we </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1109">actually at least only have two ways of doing this. You can start to collapse this more, </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1114">but I don't know, programming with Docker locally is not great. So what ended up actually </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1119">happening? If you notice, it was August 2022 was when I needed to finish this by. If we </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1125">go back and look at some of our timestamps, you can see that it was July 26, that I sent </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1131">that tweet at Vicki. Next day, I submitted a PR. And my goal was to get that PR reviewed </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1138">by August 3, for the very important reason that I was going to be on vacation, and I </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1145">didn't want to have to worry about this after going on vacation. And sure enough, August </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1150">4, it got merged. I went on vacation and somehow nothing broke. So that's the story of that. </a><a href="https://www.youtube.com/watch?v=I4wkCSd7iMM&t=1157">And you can find me elsewhere on the internet and thank you all. </a>
      </p>
    </div>
  </section>
  </body>
</html>